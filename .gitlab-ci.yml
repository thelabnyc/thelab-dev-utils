stages:
  - build


variables:
  UBUNTU_VERSION: '20.04'


build_docker_image:
  stage: build
  image: docker:latest
  only:
    - master
  script:
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_JOB_TOKEN" "$CI_REGISTRY"
    - docker pull "$CI_REGISTRY_IMAGE:latest"
    - docker pull "ubuntu:${UBUNTU_VERSION}"
    - docker build --build-arg UBUNTU_VERSION=$UBUNTU_VERSION -t "$CI_REGISTRY_IMAGE:latest" .
    - docker push "$CI_REGISTRY_IMAGE:latest"
